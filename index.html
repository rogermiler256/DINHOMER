<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Tour Virtual con Video Embed</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <style>
      body, html {
        margin: 0;
        padding: 0;
        overflow: hidden;
      }

      .video-embed {
        position: fixed;
        top: 60px;
        left: 40px;
        width: 150px;
        aspect-ratio: 16 / 16;
        z-index: 9999;
        border-radius: 100px;
        overflow: hidden;
        box-shadow: 0 0 25px rgba(0, 0, 0, 0.6);
      }

      .video-embed iframe {
        width: 100%;
        height: 100%;
        border: none;
      }
    </style>
  </head>

  <body>
    <!-- Escena A-Frame -->
    <a-scene cursor="rayOrigin: mouse" raycaster="objects: .clickable">
      <!-- Fondos para transición -->
      <a-sky id="sky" src="M1.png" rotation="0 -130 0"></a-sky>
      <a-sky id="sky-fade" visible="false" opacity="0" rotation="0 -130 0"></a-sky>

      <!-- Cámara -->
      <a-entity id="cam" camera look-controls wasd-controls position="0 1.6 0"></a-entity>
    </a-scene>

    <!-- Video embebido circular -->
    <div class="video-embed">
      <iframe 
        src="https://share.synthesia.io/embeds/videos/6da60b89-faa1-4bf6-9984-d268b3d57ac1" 
        loading="lazy" 
        title="Tour del edén campestre"
        allow="accelerometer; clipboard-write; ; gyroscope;" 
        allowfullscreen>
      </iframe>
    </div>

    <script>
      const hotspots = {
        "M1.png": [
          { img: "M2.png", position: "3 0.01 -3", label: "Ruta hacia el Metaverso" },
          { img: "M3.png", position: "-3 0.01 -3", label: "Bienvenidos a EDEN CAMPESTRE" }
        ],
        "M2.png": [
          { img: "M1.png", position: "-3 0.01 -3", label: "Volver" },
          { img: "M3.png", position: "3 0.01 -3", label: "Visita LOS LOTES " }
        ],
        "M3.png": [
          { img: "M1.png", position: "-3 0.01 -3", label: "Volver" },
          { img: "M2.png", position: "3 0.01 -3", label: "Ruta hacia el metaverso" }
        ]
      };

      const scene = document.querySelector("a-scene");
      const sky = document.querySelector("#sky");
      const skyFade = document.querySelector("#sky-fade");

      function transitionTo(newImg) {
        skyFade.setAttribute("src", newImg);
        skyFade.setAttribute("visible", true);
        skyFade.setAttribute("opacity", 0);

        skyFade.setAttribute("animation__fadein", {
          property: "material.opacity",
          from: 0,
          to: 1,
          dur: 12000
        });

        setTimeout(() => {
          sky.setAttribute("src", newImg);
          skyFade.setAttribute("visible", false);
          skyFade.removeAttribute("animation__fadein");
          createHotspots(newImg);
        }, 1000);
      }

      function createHotspots(imageName) {
        document.querySelectorAll(".hotspot").forEach(el => el.remove());
        const data = hotspots[imageName];
        if (!data) return;

        data.forEach(h => {
          const wrapper = document.createElement("a-entity");
          wrapper.setAttribute("position", h.position);
          wrapper.setAttribute("class", "hotspot");

          // Área clickeable invisible
          const hitArea = document.createElement("a-circle");
          hitArea.setAttribute("radius", "1");
          hitArea.setAttribute("rotation", "-90 0 0");
          hitArea.setAttribute("material", "color: #fff; opacity: 0.001; transparent: true");
          hitArea.setAttribute("class", "clickable");
          hitArea.setAttribute("data-img", h.img);
          hitArea.addEventListener("click", () => transitionTo(h.img));

          // Anillo exterior
          const ring1 = document.createElement("a-ring");
          ring1.setAttribute("radius-inner", "0.5");
          ring1.setAttribute("radius-outer", "0.7");
          ring1.setAttribute("color", "#ffffff");
          ring1.setAttribute("rotation", "-90 0 0");
          ring1.setAttribute("material", "shader: flat");
          ring1.setAttribute("animation", {
            property: "scale",
            dir: "alternate",
            dur: 1000,
            loop: true,
            to: "1.2 1.2 1.2",
            easing: "easeInOutSine"
          });

          // Anillo interior
          const ring2 = document.createElement("a-ring");
          ring2.setAttribute("radius-inner", "0.3");
          ring2.setAttribute("radius-outer", "0.45");
          ring2.setAttribute("color", "#ffffff");
          ring2.setAttribute("rotation", "-90 0 0");
          ring2.setAttribute("material", "shader: flat");
          ring2.setAttribute("animation", {
            property: "scale",
            dir: "alternate",
            dur: 1000,
            loop: true,
            to: "1.15 1.15 1.15",
            easing: "easeInOutSine"
          });

          // Texto flotante
          const label = document.createElement("a-text");
          label.setAttribute("value", h.label);
          label.setAttribute("align", "center");
          label.setAttribute("color", "#FFF");
          label.setAttribute("position", "0 1 0");
          label.setAttribute("look-at", "#cam");
          label.setAttribute("width", "4");

          wrapper.appendChild(hitArea);
          wrapper.appendChild(ring1);
          wrapper.appendChild(ring2);
          wrapper.appendChild(label);
          scene.appendChild(wrapper);
        });
      }

      window.addEventListener("load", () => {
        createHotspots("M1.png");
      });
    </script>
  </body>
</html>
